const DefaultCaptionStyle = {
  color: 'white',
  fontFamily: '"Netflix Sans", "Helvetica Nueue", Helvetica, Arial, sans-serif',
  fontSize: '33px',
  fontWeight: 'bolder',
  textShadow: 'rgb(0, 0, 0) 0px 0px 7px'
};

const NetflixAdapter = {
  root: document.body,
  uniqueSelector: '.nfp.AkiraPlayer',
  value: (node) => {
    // TODO - Differeniate between props that apply to the DC elements. and those that reference the DOM
    // Eg. dcCaptionStyle, dcCaptionWindowStyle
    let canRenderInCaptionWindow = true;
    let captionStyle = DefaultCaptionStyle;
    let captionWindow = null;
    let captionWindowPosition = null;
    let captionWindowStyle = { textAlign: 'center', width: '700px' };
    let video = document.querySelector('video') || null;

    let isRenderingImageSubtitles = !!document.querySelector('.image-based-timed-text image');

    if (isRenderingImageSubtitles) {
      canRenderInCaptionWindow = false;
      captionWindow = document.querySelector('.image-based-timed-text image') || null;
      captionWindowPosition = captionWindow ? JSON.stringify({
        x: captionWindow.getAttribute('x'),
        y: captionWindow.getAttribute('y')
      }) : null;
    } else {
      captionWindow = document.querySelector('.player-timedtext-text-container') || null;
      if (captionWindow) {
        captionWindowPosition = captionWindow.style.cssText;
        let caption = captionWindow.querySelector('span');
        if (caption) {
          captionStyle = {
            background: caption.style.background,
            backgroundColor: caption.style.backgroundColor,
            color: caption.style.color,
            fontFamily: caption.style.fontFamily,
            fontSize: caption.style.fontSize,
            fontWeight: caption.style.fontWeight,
            textShadow: caption.style.textShadow
          };
        }
      }
    }

    return {
      canRenderInCaptionWindow,
      captionWindow,
      captionWindowPosition,
      captionWindowStyle,
      captionStyle,
      video
    };
  }
};

export default NetflixAdapter;
